<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Admin Login - CampSphere</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="/css/modern-style.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f59e0b 0%, #f97316 50%, #fb923c 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('/assets/camp-hero.jpg') center/cover no-repeat;
            opacity: 0.1;
            z-index: 0;
        }
        
        .login-container {
            position: relative;
            z-index: 1;
            width: 100%;
            max-width: 480px;
            padding: 1rem;
        }
        
        .login-card {
            background: white;
            border-radius: 2rem;
            padding: 3rem 2.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .login-icon {
            width: 80px;
            height: 80px;
            border-radius: 1.5rem;
            background: linear-gradient(135deg, #f59e0b 0%, #fb923c 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            margin: 0 auto 1.5rem;
            box-shadow: 0 10px 20px rgba(245, 158, 11, 0.3);
        }
        
        .error-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            animation: fadeIn 0.3s ease;
        }
        
        .error-modal.show {
            display: flex;
        }
        
        .error-modal-content {
            background: white;
            border-radius: 1.5rem;
            padding: 2.5rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }
        
        .error-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-size: 3rem;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>

<!-- Error Modal -->
<div id="errorModal" class="error-modal">
    <div class="error-modal-content">
        <div class="error-icon">‚úï</div>
        <h3 class="fw-bold mb-2" style="color: #dc2626;">Login Failed</h3>
        <p class="text-muted mb-4" id="errorMessage">An error occurred during login.</p>
        <button onclick="closeErrorModal()" class="btn btn-modern-secondary w-100 py-3">
            Try Again
        </button>
    </div>
</div>

<!-- Back to Home Button -->
<div style="position: absolute; top: 1.5rem; left: 1.5rem; z-index: 10;">
    <a href="/" class="btn btn-light rounded-pill px-4">
        ‚Üê Back to Home
    </a>
</div>

<!-- Login Container -->
<div class="login-container">
    <div class="login-card">
        <div class="login-icon">üëî</div>
        <h2 class="text-center fw-bold mb-2">Admin Login</h2>
        <p class="text-center text-muted mb-4">Secure access to CampSphere Admin Portal</p>
        
        <form id="adminLoginForm">
            <div class="mb-3">
                <label for="admin-email" class="modern-form-label">Email Address</label>
                <input type="email" id="admin-email" name="email" class="modern-form-control" placeholder="admin@campsphere.com" required />
            </div>
            <div class="mb-4">
                <label for="admin-password" class="modern-form-label">Password</label>
                <input type="password" id="admin-password" name="password" class="modern-form-control" placeholder="Enter your password" required />
            </div>
            <button type="submit" class="btn btn-modern-secondary w-100 py-3 mb-3">
                Login to Dashboard
            </button>
        </form>
        
        <div class="text-center">
            <p class="text-muted mb-0">
                <small>üîí Secure admin access only</small>
            </p>
        </div>
    </div>
    
    <div class="text-center mt-4">
        <p class="text-white mb-2">
            <small>Need help? <a href="#" class="text-white fw-semibold">Contact Support</a></small>
        </p>
    </div>
</div>

<script>
    function showErrorModal(message) {
        document.getElementById("errorMessage").textContent = message;
        document.getElementById("errorModal").classList.add("show");
    }
    
    function closeErrorModal() {
        document.getElementById("errorModal").classList.remove("show");
    }
    
    document.getElementById("adminLoginForm").addEventListener("submit", async e => {
      e.preventDefault();
      const form = e.target;
      const params = new URLSearchParams();
      params.append("email", form.email.value.trim());
      params.append("password", form.password.value);

      try {
        const res = await fetch("/api/auth/admin/login", {
          method: "POST",
          credentials: "include",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: params
        });

        if (!res.ok) {
          const err = await res.text();
          showErrorModal(err || "Admin login failed. Please check your credentials.");
          return;
        }
        
        // Try to parse as JSON, fallback to text
        let admin;
        const contentType = res.headers.get("content-type");
        if (contentType && contentType.includes("application/json")) {
          admin = await res.json();
        } else {
          // If it's just text (success message), create a minimal admin object
          const text = await res.text();
          admin = { email: form.email.value.trim() };
        }
        
        // Set session for navbar
        sessionStorage.setItem("userRole", "ADMIN");
        sessionStorage.setItem("userName", admin.name || admin.email || "Admin");
        if (admin.id) sessionStorage.setItem("userId", admin.id);
        
        window.location.href = "/admin-dashboard.html";
      } catch (error) {
        console.error("Login error:", error);
        showErrorModal("Network error. Please check your connection and try again.");
      }
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
